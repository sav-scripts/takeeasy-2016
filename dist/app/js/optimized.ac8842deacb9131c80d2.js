!function(a,b,c){function d(a,b){return typeof a===b}function e(){var a,b,c,e,f,g,h;for(var i in t)if(t.hasOwnProperty(i)){if(a=[],b=t[i],b.name&&(a.push(b.name.toLowerCase()),b.options&&b.options.aliases&&b.options.aliases.length))for(c=0;c<b.options.aliases.length;c++)a.push(b.options.aliases[c].toLowerCase());for(e=d(b.fn,"function")?b.fn():b.fn,f=0;f<a.length;f++)g=a[f],h=g.split("."),1===h.length?v[h[0]]=e:(!v[h[0]]||v[h[0]]instanceof Boolean||(v[h[0]]=new Boolean(v[h[0]])),v[h[0]][h[1]]=e),s.push((e?"":"no-")+h.join("-"))}}function f(a){var b=w.className,c=v._config.classPrefix||"";if(x&&(b=b.baseVal),v._config.enableJSClass){var d=new RegExp("(^|\\s)"+c+"no-js(\\s|$)");b=b.replace(d,"$1"+c+"js$2")}v._config.enableClasses&&(b+=" "+c+a.join(" "+c),x?w.className.baseVal=b:w.className=b)}function g(){return"function"!=typeof b.createElement?b.createElement(arguments[0]):x?b.createElementNS.call(b,"http://www.w3.org/2000/svg",arguments[0]):b.createElement.apply(b,arguments)}function h(){var a=b.body;return a||(a=g(x?"svg":"body"),a.fake=!0),a}function i(a,c,d,e){var f,i,j,k,l="modernizr",m=g("div"),n=h();if(parseInt(d,10))for(;d--;)j=g("div"),j.id=e?e[d]:l+(d+1),m.appendChild(j);return f=g("style"),f.type="text/css",f.id="s"+l,(n.fake?n:m).appendChild(f),n.appendChild(m),f.styleSheet?f.styleSheet.cssText=a:f.appendChild(b.createTextNode(a)),m.id=l,n.fake&&(n.style.background="",n.style.overflow="hidden",k=w.style.overflow,w.style.overflow="hidden",w.appendChild(n)),i=c(m,a),n.fake?(n.parentNode.removeChild(n),w.style.overflow=k,w.offsetHeight):m.parentNode.removeChild(m),!!i}function j(a,b){return!!~(""+a).indexOf(b)}function k(a){return a.replace(/([a-z])-([a-z])/g,function(a,b,c){return b+c.toUpperCase()}).replace(/^-/,"")}function l(a,b){return function(){return a.apply(b,arguments)}}function m(a,b,c){var e;for(var f in a)if(a[f]in b)return c===!1?a[f]:(e=b[a[f]],d(e,"function")?l(e,c||b):e);return!1}function n(a){return a.replace(/([A-Z])/g,function(a,b){return"-"+b.toLowerCase()}).replace(/^ms-/,"-ms-")}function o(b,d){var e=b.length;if("CSS"in a&&"supports"in a.CSS){for(;e--;)if(a.CSS.supports(n(b[e]),d))return!0;return!1}if("CSSSupportsRule"in a){for(var f=[];e--;)f.push("("+n(b[e])+":"+d+")");return f=f.join(" or "),i("@supports ("+f+") { #modernizr { position: absolute; } }",function(a){return"absolute"==getComputedStyle(a,null).position})}return c}function p(a,b,e,f){function h(){l&&(delete E.style,delete E.modElem)}if(f=!d(f,"undefined")&&f,!d(e,"undefined")){var i=o(a,e);if(!d(i,"undefined"))return i}for(var l,m,n,p,q,r=["modernizr","tspan"];!E.style;)l=!0,E.modElem=g(r.shift()),E.style=E.modElem.style;for(n=a.length,m=0;n>m;m++)if(p=a[m],q=E.style[p],j(p,"-")&&(p=k(p)),E.style[p]!==c){if(f||d(e,"undefined"))return h(),"pfx"!=b||p;try{E.style[p]=e}catch(a){}if(E.style[p]!=q)return h(),"pfx"!=b||p}return h(),!1}function q(a,b,c,e,f){var g=a.charAt(0).toUpperCase()+a.slice(1),h=(a+" "+B.join(g+" ")+g).split(" ");return d(b,"string")||d(b,"undefined")?p(h,b,e,f):(h=(a+" "+C.join(g+" ")+g).split(" "),m(h,b,c))}function r(a,b,d){return q(a,c,c,b,d)}var s=[],t=[],u={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(a,b){var c=this;setTimeout(function(){b(c[a])},0)},addTest:function(a,b,c){t.push({name:a,fn:b,options:c})},addAsyncTest:function(a){t.push({name:null,fn:a})}},v=function(){};v.prototype=u,v=new v;var w=b.documentElement,x="svg"===w.nodeName.toLowerCase();v.addTest("canvas",function(){var a=g("canvas");return!(!a.getContext||!a.getContext("2d"))});var y=u._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];u._prefixes=y,v.addTest("opacity",function(){var a=g("a").style;return a.cssText=y.join("opacity:.55;"),/^0.55$/.test(a.opacity)});var z=u.testStyles=i;v.addTest("touchevents",function(){var c;if("ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch)c=!0;else{var d=["@media (",y.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");z(d,function(a){c=9===a.offsetTop})}return c});var A="Moz O ms Webkit",B=u._config.usePrefixes?A.split(" "):[];u._cssomPrefixes=B;var C=u._config.usePrefixes?A.toLowerCase().split(" "):[];u._domPrefixes=C;var D={elem:g("modernizr")};v._q.push(function(){delete D.elem});var E={style:D.elem.style};v._q.unshift(function(){delete E.style}),u.testAllProps=q,u.testAllProps=r,v.addTest("bgsizecover",r("backgroundSize","cover")),e(),f(s),delete u.addTest,delete u.addAsyncTest;for(var F=0;F<v._q.length;F++)v._q[F]();a.Modernizr=v}(window,document),function(){function a(a){console.log("statusChangeCallback"),console.log(a),"connected"===a.status?console.log("connected"):"not_authorized"===a.status?console.log("not authorized"):console.log("not login")}function b(a){for(var b=atob(a.split(",")[1]),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([c],{type:"image/png"})}function c(a,b,c){this.api=a,this.apiParams=b,this.after=null,this.dataList=[],this.thereIsMore=!0,this.cbFetchComplete=c,this.lastFetchIndex=0}var d,e=window.FBHelper={},f=["public_profile"];e.uid=null,e.uname=null,e.init=function(b,c,e){"string"==typeof b&&(b={appId:b,cookie:!0,xfbml:!0,version:"v2.4"}),d=b.appId,window.fbAsyncInit=function(){FB.init(b),e&&FB.getLoginStatus(function(b){a(b)}),c&&c.apply()},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/zh_TW/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")},e.login=function(a,b,c){a||(a=f),FB.login(function(a){a.authResponse?(e.uid=a.authResponse.userID,"connected"==a.status?null!=b&&b.apply(null,[a]):null!=c&&c.apply(null,[{action:"login",response:a,type:a.status,message:"not connected"}])):null!=c&&c.apply(null,[{action:"login",response:a,type:a.status,message:"user cancel login"}])},{scope:a})},e.getPublicProfile=function(a){FB.api("/me",function(b){e.uname=b.name,a.apply(null,[b])})},e.checkLoginStatus=function(a,b){function c(c){for(var d={},e=a.length,f=0,g=0;g<a.length;g++)d[a[g]]=!1;FB.api("/me/permissions",function(a){if(a&&a.data&&a.data.length){var g,h;for(g=0;g<a.data.length;g++)h=a.data[g],void 0!==d[h.permission]&&(d[h.permission]=!0,f++);f<e?b.call(null,{message:"lack permission",permissionDic:d},null):b.call(null,null,c)}else b.call(null,{message:"check permission fail"},null)})}FB.getLoginStatus(function(d){"connected"===d.status?a?c(d.authResponse):b.call(null,null,d.authResponse):b.call(null,{message:"no connect"},null)})},e.postImageToFacebook=function(a,c,d){var e,f=a.toDataURL("image/png");try{e=b(f)}catch(a){console.log(a)}var g=new FormData;g.append("access_token",c),g.append("source",e);try{$.ajax({url:"https://graph.facebook.com/me/photos?access_token="+c,type:"POST",data:g,processData:!1,contentType:!1,cache:!1,success:function(a){d.call(null,null,a)},error:function(a,b,c){d.call(null,"error "+c+" Status "+a.status)},complete:function(){}})}catch(a){d.call(null,a)}},window.FBData=c,c.prototype.fetch=function(){var a=this;return a.thereIsMore||(console.log("warning: trying to fetch data where there is no more."),a.cbFetchComplete.call(a,a.dataList)),a.lastFetchIndex=a.dataList.length,FB.api(a.api,"GET",a.apiParams,function(b){b.error?console.error(b.error):(a.dataList=a.dataList.concat(b.data),a.apiParams.after=Boolean(b.paging&&b.paging.next)?b.paging.cursors.after:null,a.apiParams.after?a.thereIsMore=!0:(delete a.apiParams.after,a.thereIsMore=!1),a.cbFetchComplete.call(a,a.dataList))}),this}}(),function(){"use strict";function a(a){var b=parseInt(a);return isNaN(b)&&(b=0),b}var b=window.Helper={};b.getSize_cover=function(a,b,c,d){var e,f,g=a/b,h=c/d;h>g?(f=b,e=f*h):(e=a,f=e/h);var i=e/c,j=a/i,k=b/i,l={x:.5*(c-j),y:.5*(d-k),width:j,height:k};return{width:e,height:f,ratio:i,contentCenterBound:l}},b.getSize_contain=function(a,b,c,d){var e,f,g=a/b,h=c/d;return h>g?(e=a,f=e/h):(f=b,e=f*h),{width:e,height:f,ratio:e/c}},Helper.extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),e},Helper.$extract=function(a,b,c,d){null==d&&(d=0),null==b&&(b=document);var e=$(b).find(a).get(d);return e||console.error("can't find dom, selector: "+a+", source: "+b),Helper.getInitValue(e),null!=c&&c.appendChild(e),$(e)},Helper.pxToPercent=function(b,c,d,e,f){function g(b,c,d){null==d&&(d=100);var e=Helper.styleDic[b];e||(e=b);var g=a(i.css(e)),h=g/c*d+"%";f?f[b]=h:0!=g&&i.css(e,h)}e||(e={w:!0,h:!1,l:!0,t:!1,r:!0,b:!1});var h,i=$(b);for(h in e){var j=1==e[h]?c:d;g(h,j)}},Helper.clearStyles=function(a){$(a).removeAttr("style")},Helper.getInitValue=function(b,c,d,e,f,g){b.init||(b.init={}),b.geom||(b.geom={}),f&&Helper.clearStyles(b);var h,i;if(g?(h=b.init[g]={},i=b.geom[g]={}):(h=b.init,i=b.geom),c||(b.currentStyle?(i.w=h.w=a(b.currentStyle.width),i.h=h.h=a(b.currentStyle.height),i.ml=h.ml=a(b.currentStyle.marginLeft),i.mt=h.mt=a(b.currentStyle.marginTop),i.mr=h.mr=a(b.currentStyle.marginRight),i.mb=h.mb=a(b.currentStyle.marginBottom),i.t=h.t=a(b.currentStyle.top),i.l=h.l=a(b.currentStyle.left),i.r=h.r=a(b.currentStyle.right),i.b=h.b=a(b.currentStyle.bottom)):(i.w=h.w=$(b).width(),i.h=h.h=$(b).height(),i.ml=h.ml=a($(b).css("margin-left")),i.mt=h.mt=a($(b).css("margin-top")),i.mr=h.mr=a($(b).css("margin-right")),i.mb=h.mb=a($(b).css("margin-bottom")),i.t=h.t=a($(b).css("top")),i.l=h.l=a($(b).css("left")),i.r=h.r=a($(b).css("right")),i.b=h.b=a($(b).css("bottom")))),i.scale=h.scale=1,d)for(var j=0;j<d.length;j++){var k=d[j];h[k]=i[k]=a($(b).css(k))}if(e){var l,m,n;l=e.width,m=e.height,n=e.styleDic,Helper.pxToPercent(b,l,m,n,h)}},Helper.styleDic={l:"left",r:"right",t:"top",b:"bottom",ml:"margin-left",mr:"margin-right",mt:"margin-top",mb:"margin-bottom",w:"width",h:"height"},Helper.applyTransform=function(a,b,c,d,e,f){var g,h;f?(g=a.init[f],h=a.geom[f]):(g=a.init,h=a.geom);var i,j,k,l,m=null!=b?g.scale*b:g.scale,n=$(a);if(c)for(j=c.length,i=0;i<j;i++)k=c[i],l=Helper.styleDic[k],l||(l=k),h[k]=g[k]*m,n.css(l,h[k]+"px");if(d)for(j=d.length,i=0;i<j;i++)k=d[i],l=Helper.styleDic[k],h[k]=g[k]*m,n.css(l,h[k]+"%");if(e)for(j=e.length,i=0;i<j;i++)k=e[i],l=Helper.styleDic[k],l||(l=k),n.css(l,g[k])},Helper.transformDom=function(a,b,c,d,e){var f=null!=b?a.init.scale*b:a.init.scale;0!=e&&(e===!0?(a.geom.w=a.init.w*f,a.geom.h=a.init.h*f,$(a).css("width",a.geom.w).css("height",a.geom.h)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)))),0!=c&&(c===!0?(a.geom.t=a.init.t*f,a.geom.l=a.init.l*f,$(a).css("top",a.geom.t).css("left",a.geom.l)):(c.l&&(a.geom.l=a.init.l*f,$(a).css("left",a.geom.l)),c.t&&(a.geom.t=a.init.t*f,$(a).css("top",a.geom.t)),c.r&&(a.geom.r=a.init.r*f,$(a).css("right",a.geom.r)),c.b&&(a.geom.b=a.init.b*f,$(a).css("bottom",a.geom.b)))),0!=d&&(d===!0?(a.geom.mt=a.init.mt*f,a.geom.ml=a.init.ml*f,$(a).css("margin-top",a.geom.mt).css("margin-left",a.geom.ml)):(c.ml&&(a.geom.ml=a.init.ml*f,$(a).css("margin-left",a.geom.ml)),c.mt&&(a.geom.mt=a.init.mt*f,$(a).css("margin-top",a.geom.mt)),c.mr&&(a.geom.mr=a.init.mr*f,$(a).css("margin-right",a.geom.mr)),c.mb&&(a.geom.mb=a.init.mb*f,$(a).css("margin-bottom",a.geom.mb))))},Helper.downScaleImage=function(a,b,c,d,e,f){var g=document.createElement("canvas");g.width=a.width,g.height=a.height;var h=g.getContext("2d");return h.drawImage(a,0,0),Helper.downScaleCanvas(g,b,c,d,e,f)},Helper.downScaleCanvas=function(a,b,c,d,e,f){if(c||(c=0),d||(d=0),!(b<1&&b>0))throw"scale must be a positive number <1 ";var g=b*b,h=a.width,i=a.height,j=Math.floor(h*b),k=Math.floor(i*b),l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=!1,B=!1,C=a.getContext("2d").getImageData(0,0,h,i).data,D=new Float32Array(3*j*k),E=0,F=0,G=0;for(m=0;m<i;m++)for(p=m*b,t=0|p,q=3*t*j,B=t!=(0|p+b),B&&(y=t+1-p,z=p+b-t-1),l=0;l<h;l++,n+=4)o=l*b,s=0|o,r=q+3*s,A=s!=(0|o+b),A&&(w=s+1-o,x=o+b-s-1),E=C[n],F=C[n+1],G=C[n+2],A||B?A&&!B?(u=w*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*b,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v):B&&!A?(u=y*b,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=z*b,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v):(u=w*y,D[r]+=E*u,D[r+1]+=F*u,D[r+2]+=G*u,v=x*y,D[r+3]+=E*v,D[r+4]+=F*v,D[r+5]+=G*v,v=w*z,D[r+3*j]+=E*v,D[r+3*j+1]+=F*v,D[r+3*j+2]+=G*v,v=x*z,D[r+3*j+3]+=E*v,D[r+3*j+4]+=F*v,D[r+3*j+5]+=G*v):(D[r]+=E*g,D[r+1]+=F*g,D[r+2]+=G*g);var H=document.createElement("canvas");H.width=e?e:j,H.height=f?f:k;var I=H.getContext("2d"),J=I.getImageData(0,0,j,k),K=J.data,L=0;for(n=0,r=0;L<j*k;n+=3,r+=4,L++)K[r]=Math.ceil(D[n]),K[r+1]=Math.ceil(D[n+1]),K[r+2]=Math.ceil(D[n+2]),K[r+3]=255;return I.putImageData(J,c,d),H},Helper.imageToCanvas=function(a,b,c){var d=document.createElement("canvas"),e=1,f=b,g=c;d.width=f,d.height=g;var h=d.getContext("2d"),i=Helper.getSize_cover(f,g,a.width,a.height),j=.5*(f-i.width),k=.5*(g-i.height);return i.ratio<1?($(d).detach(),d=Helper.downScaleImage(a,i.ratio,j,k,f,g)):h.drawImage(a,0,0,a.width,a.height,j,k,i.width*e,i.height),d},Helper.getContextBoundingBox=function(a,b){void 0===b&&(b=15);var c,d,e,f,g,h,i=a.canvas.width,j=a.canvas.height,k=a.getImageData(0,0,i,j).data;a:for(d=j;d--;)for(c=i;c--;)if(k[4*(i*d+c)+3]>b){h=d;break a}if(h){a:for(c=i;c--;)for(d=h+1;d--;)if(k[4*(i*d+c)+3]>b){g=c;break a}a:for(c=0;c<=g;++c)for(d=h+1;d--;)if(k[4*(i*d+c)+3]>b){e=c;break a}a:for(d=0;d<=h;++d)for(c=e;c<=g;++c)if(k[4*(i*d+c)+3]>b){f=d;break a}return{x:e,y:f,maxX:g,maxY:h,w:g-e,h:h-f}}}}(),function(){function a(a){return g&&(a=g.call(null,a)),a}function b(){k=!1,null!=n&&(n.apply(),n=null),e&&e.apply()}var c,d,e,f,g,h,i=window.SceneHandler={},j={},k=!1,l=null,m=null,n=null,o=null,p="/Index",q=!1,r=!0,s={},t={};i.currentScene=null,i.processHashNames=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];_contentClasses.push(window[d]),b.push("/"+d)}return b},i.getLastHash=function(){return m},i.init=function(b,h){h=h||{},c=h.version||"0",d=h.cbBeforeChange,e=h.cbAfterChange,g=h.hashChangeTester,f=h.cbContentChange,o=h.cbContentLoaded,r=void 0===h.listeningHashChange||h.listeningHashChange;var l,m,p;if(h.blockHashs)for(l=0;l<h.blockHashs.length;l++)t[h.blockHashs[l]]=!0;for(l=0;l<b.length;l++)m=b[l],p={hash:m,index:l,stageClass:window[m.replace("/","")]},p.stageClass||console.error("class for: "+m+" is not exist"),j[m]=p;r&&i.onHashChange(function(b){""==b&&(b="/Index"),b=a(b),b&&j[b]&&!t[b]&&(k?n=function(){i.toContent(b)}:i.toContent(b))})},i.setLock=function(a){q=a},i.onHashChange=function(a){function b(){q||(h?h=!1:a.apply(null,[i.getHash()]))}if("onhashchange"in window)window.onhashchange=function(){b()};else{var c=window.location.hash;window.setInterval(function(){window.location.hash!=c&&(c=window.location.hash,b())},100)}},i.getHash=function(){return window.location.hash.replace("#","")},i.setHash=function(a,b){b&&(h=!0),window.location.hash="#"+a},i.toFirstHash=function(b){var c=i.getHash();r&&j[c]&&!t[c]||(c=p),c=a(c),c&&i.toContent(c,b)},i.toHash=function(a){a||(a=p),r&&i.getHash()!=a?i.setHash(a):i.toContent(a)},i.toContent=function(a,c){if(!k&&(""==a&&(a=p),l!=a)){var e,g;c||(c={}),c.firstIn=!1,c.cbContentLoaded=o,k=!0,f&&f.call(null,a),c.lastHash=l,null==l?(c.isFirstIn=!0,m=l,l=a,e=j[a],i.currentScene=e.stageClass,e.stageClass.stageIn(c,b)):j[l]&&j[a]&&(d&&d.apply(),g=j[l],e=j[a],i.currentScene=e.stageClass,m=l,l=a,g.stageClass.stageOut(c,function(){e.stageClass.stageIn(c,b)}))}},i.loadTemplate=function(a,b,d){function e(a){function f(){a++,a>=b.length?(Loading.hide(),d.apply(null)):e(a)}if(0==b.length)return Loading.hide(),void d.apply(null);null==a&&(a=0);var g,h=b[a].url;s[h]?(b[a].dom=s[h],f()):(Loading.progress(0),g=document.createElement("div"),$(g).load(b[a].url+"?v="+c,function(){s[h]=g;var c=b.extractClass;c||(c="extract-point");var d=b[a].dom=$(g).find("."+c)[0];$(d).toggleClass(c,!1),$("#invisible-container").append(d),$(d).waitForImages(function(){d.parentNode&&d.parentNode.removeChild(d),f()},function(a,b){var c=a/b;Loading.progress(c)},!0)}))}Loading.show(),null!=a?Utility.preloadImages(a.list,e,function(a){Loading.progress(a/100)}):e(0)}}(),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){var b="waitForImages";a.waitForImages={hasImageProperties:["backgroundImage","listStyleImage","borderImage","borderCornerImage","cursor"],hasImageAttributes:["srcset"]},a.expr[":"]["has-src"]=function(b){return a(b).is('img[src][src!=""]')},a.expr[":"].uncached=function(b){return!!a(b).is(":has-src")&&!b.complete},a.fn.waitForImages=function(){var c,d,e,f=0,g=0,h=a.Deferred();if(a.isPlainObject(arguments[0])?(e=arguments[0].waitForAll,d=arguments[0].each,c=arguments[0].finished):1===arguments.length&&"boolean"===a.type(arguments[0])?e=arguments[0]:(c=arguments[0],d=arguments[1],e=arguments[2]),c=c||a.noop,d=d||a.noop,e=!!e,!a.isFunction(c)||!a.isFunction(d))throw new TypeError("An invalid callback was supplied.");return this.each(function(){var i=a(this),j=[],k=a.waitForImages.hasImageProperties||[],l=a.waitForImages.hasImageAttributes||[],m=/url\(\s*(['"]?)(.*?)\1\s*\)/g;e?i.find("*").addBack().each(function(){var b=a(this);b.is("img:has-src")&&j.push({src:b.attr("src"),element:b[0]}),a.each(k,function(a,c){var d,e=b.css(c);if(!e)return!0;for(;d=m.exec(e);)j.push({src:d[2],element:b[0]})}),a.each(l,function(c,d){var e,f=b.attr(d);return!f||(e=f.split(","),void a.each(e,function(c,d){d=a.trim(d).split(" ")[0],j.push({src:d,element:b[0]})}))})}):i.find("img:has-src").each(function(){j.push({src:this.src,element:this})}),f=j.length,g=0,0===f&&(c.call(i[0]),h.resolveWith(i[0])),a.each(j,function(e,j){var k=new Image,l="load."+b+" error."+b;a(k).one(l,function b(e){var k=[g,f,"load"==e.type];return g++,d.apply(j.element,k),h.notifyWith(j.element,k),a(this).off(l,b),g==f?(c.call(i[0]),h.resolveWith(i[0]),!1):void 0}),k.src=j.src})}),h.promise()}}),function(){var a=(window.Utility={},{}),b={};b.log="log",b.warn="warn",b.error="error",b.debug="debug",b.info="info",Utility.setConsoleMethod=function(b,c){1==c?console[b]=a[b]:console[b]=function(){}},Utility.disableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!1)},Utility.enableAllConsoleMethods=function(){for(var a in b)this.setConsoleMethod(a,!0)},function(){if(!window.console){window.console={};for(var c in b)console[b[c]]=function(){}}for(var c in b)a[b[c]]=console[b[c]];window.Array.prototype.indexOf||(window.Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1})}();var c={};Utility.analyzeURL=function(a){if(!c[a]){var b=/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/;c[a]=a.match(b)}return c[a]},Utility.getPath=function(a){a||(a=window.location.href);var b=a.indexOf("?")==-1?a:a.substr(0,a.indexOf("?"));b.indexOf("#")!==-1&&(b=b.substr(0,b.indexOf("#")));var c=b.split("/"),d=c[c.length-1];for(d.indexOf(".")!==-1&&c.pop(),b=c.join("/");b.length&&"/"==b.charAt(b.length-1);)b=b.slice(0,b.length-1);return b+="/"},Utility.getProtocol=function(a){return a||(a=window.location.href),Utility.analyzeURL(a)[2]},Utility.urlParams=function(){var a=decodeURIComponent(window.location.href),b=a.split("?")[1];if(!b)return{};b=b.split("#")[0];for(var c={},d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");c[f[0]]=f[1]}return c}(),Utility.isLocalhost=function(){var a=window.location.toString().split("/")[2];return"localhost"==a||"192"==a.split(".")[0]}(),Utility.preloadImages=function(a,b,c,d){function e(){function g(){null!=i&&(i.collector[i.name]=j),j.onerror=null,j.onload=null,e()}if(c&&c.apply(null,[f/a.length*100<<0]),f>=a.length)return void(b&&b.apply());var h=a[f],i=null;"string"!=typeof h&&(i=h,h=i.url),f++;var j=new Image;j.onload=g,d&&(j.onerror=function(){console.error("load image error: ["+h+"]"),g()}),j.src=h}if(null==d&&(d=!0),!a||0==a.length)return void(b&&b.apply());var f=0;e()},Utility.shuffleArray=function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},Utility.isiOS=function(){var a=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;a.length;)if(navigator.platform===a.pop())return!0;return!1}}(),function(){var a=window.PatternSamples={};a.email=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,a.phone=/^(09)[0-9]{8}$/,a.number=/[0-9]/g,a.nonNumber=/[^0-9]/g,a.onlySpace=/^\s*$/,a.localPhone=/^(0)\d{1,3}(-)\d{5,8}$/,a.personId=/^[A-Z]{1}[1-2]{1}[0-9]{8}$/}(),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return!!Array.isArray(a)&&(g(a,c[b],c),!0)}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&ha(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function v(){return qa++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b,c=a.options.inputClass;return new(b=c?c:ta?M:ua?P:sa?R:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Aa&&d-e===0,g=b&(Ca|Da)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=ma(j.x)>ma(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Aa&&f.eventType!==Ca||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Da&&(i>za||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;e<b;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ea:ma(a)>=ma(b)?a<0?Fa:Ga:b<0?Ha:Ia}function H(a,b,c){c||(c=Ma);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Ma);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Na)+I(a[1],a[0],Na)}function K(a,b){return H(b[0],b[1],Na)/H(a[0],a[1],Na)}function L(){this.evEl=Pa,this.evWin=Qa,this.allow=!0,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Ta,this.evWin=Ua,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=Wa,this.evWin=Xa,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ca|Da)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=Za,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Aa|Ba)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Aa)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ca|Da)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a)}function S(a,b){this.manager=a,this.set(b)}function T(a){if(p(a,db))return db;var b=p(a,eb),c=p(a,fb);return b&&c?db:b||c?b?eb:fb:p(a,cb)?cb:bb}function U(a){this.options=ha({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=gb,this.simultaneous={},this.requireFail=[]}function V(a){return a&lb?"cancel":a&jb?"end":a&ib?"move":a&hb?"start":""}function W(a){return a==Ia?"down":a==Ha?"up":a==Fa?"left":a==Ga?"right":""}function X(a,b){var c=b.manager;return c?c.get(a):a}function Y(){U.apply(this,arguments)}function Z(){Y.apply(this,arguments),this.pX=null,this.pY=null}function $(){Y.apply(this,arguments)}function _(){U.apply(this,arguments),this._timer=null,this._input=null}function aa(){Y.apply(this,arguments)}function ba(){Y.apply(this,arguments)}function ca(){U.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function da(a,b){return b=b||{},b.recognizers=l(b.recognizers,da.defaults.preset),new ea(a,b)}function ea(a,b){this.options=ha({},da.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=y(this),this.touchAction=new S(this,this.options.touchAction),fa(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function fa(a,b){var c=a.element;c.style&&g(a.options.cssProps,function(a,d){c.style[u(c.style,d)]=b?a:""})}function ga(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ha,ia=["","webkit","Moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now;ha="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var oa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),pa=h(function(a,b){return oa(a,b,!0)},"merge","Use `assign`."),qa=1,ra=/mobile|tablet|ip(ad|hone|od)|android/i,sa="ontouchstart"in a,ta=u(a,"PointerEvent")!==d,ua=sa&&ra.test(navigator.userAgent),va="touch",wa="pen",xa="mouse",ya="kinect",za=25,Aa=1,Ba=2,Ca=4,Da=8,Ea=1,Fa=2,Ga=4,Ha=8,Ia=16,Ja=Fa|Ga,Ka=Ha|Ia,La=Ja|Ka,Ma=["x","y"],Na=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Oa={mousedown:Aa,mousemove:Ba,mouseup:Ca},Pa="mousedown",Qa="mousemove mouseup";i(L,x,{handler:function(a){
var b=Oa[a.type];b&Aa&&0===a.button&&(this.pressed=!0),b&Ba&&1!==a.which&&(b=Ca),this.pressed&&this.allow&&(b&Ca&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:xa,srcEvent:a}))}});var Ra={pointerdown:Aa,pointermove:Ba,pointerup:Ca,pointercancel:Da,pointerout:Da},Sa={2:va,3:wa,4:xa,5:ya},Ta="pointerdown",Ua="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Ta="MSPointerDown",Ua="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Ra[d],f=Sa[a.pointerType]||a.pointerType,g=f==va,h=r(b,a.pointerId,"pointerId");e&Aa&&(0===a.button||g)?h<0&&(b.push(a),h=b.length-1):e&(Ca|Da)&&(c=!0),h<0||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Va={touchstart:Aa,touchmove:Ba,touchend:Ca,touchcancel:Da},Wa="touchstart",Xa="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Va[a.type];if(b===Aa&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ca|Da)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:va,srcEvent:a})}}});var Ya={touchstart:Aa,touchmove:Ba,touchend:Ca,touchcancel:Da},Za="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=Ya[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:va,srcEvent:a})}}),i(R,x,{handler:function(a,b,c){var d=c.pointerType==va,e=c.pointerType==xa;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Ca|Da)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var $a=u(ja.style,"touchAction"),_a=$a!==d,ab="compute",bb="auto",cb="manipulation",db="none",eb="pan-x",fb="pan-y";S.prototype={set:function(a){a==ab&&(a=this.compute()),_a&&this.manager.element.style&&(this.manager.element.style[$a]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),T(a.join(" "))},preventDefaults:function(a){if(!_a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,db),f=p(d,fb),g=p(d,eb);if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}if(!g||!f)return e||f&&c&Ja||g&&c&Ka?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var gb=1,hb=2,ib=4,jb=8,kb=jb,lb=16,mb=32;U.prototype={defaults:{},set:function(a){return ha(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=X(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=X(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=X(a,this),r(b,a)===-1&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=X(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;d<jb&&b(c.options.event+V(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=jb&&b(c.options.event+V(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=mb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(mb|gb)))return!1;a++}return!0},recognize:function(a){var b=ha({},a);return k(this.options.enable,[this,b])?(this.state&(kb|lb|mb)&&(this.state=gb),this.state=this.process(b),void(this.state&(hb|ib|jb|lb)&&this.tryEmit(b))):(this.reset(),void(this.state=mb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(Y,U,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(hb|ib),e=this.attrTest(a);return d&&(c&Da||!e)?b|lb:d||e?c&Ca?b|jb:b&hb?b|ib:hb:mb}}),i(Z,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:La},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ja&&b.push(fb),a&Ka&&b.push(eb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ja?(e=0===f?Ea:f<0?Fa:Ga,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ea:g<0?Ha:Ia,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Y.prototype.attrTest.call(this,a)&&(this.state&hb||!(this.state&hb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=W(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i($,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[db]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&hb)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(_,U,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[bb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ca|Da)&&!f)this.reset();else if(a.eventType&Aa)this.reset(),this._timer=e(function(){this.state=kb,this.tryEmit()},b.time,this);else if(a.eventType&Ca)return kb;return mb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===kb&&(a&&a.eventType&Ca?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),i(aa,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[db]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&hb)}}),i(ba,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ja|Ka,pointers:1},getTouchAction:function(){return Z.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ja|Ka)?b=a.overallVelocity:c&Ja?b=a.overallVelocityX:c&Ka&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&ma(b)>this.options.velocity&&a.eventType&Ca},emit:function(a){var b=W(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ca,U,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[cb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Aa&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ca)return this.failTimeout();var g=!this.pTime||a.timeStamp-this.pTime<b.interval,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=kb,this.tryEmit()},b.interval,this),hb):kb}return mb},failTimeout:function(){return this._timer=e(function(){this.state=mb},this.options.interval,this),mb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),da.VERSION="2.0.6",da.defaults={domEvents:!1,touchAction:ab,enable:!0,inputTarget:null,inputClass:null,preset:[[aa,{enable:!1}],[$,{enable:!1},["rotate"]],[ba,{direction:Ja}],[Z,{direction:Ja},["swipe"]],[ca],[ca,{event:"doubletap",taps:2},["tap"]],[_]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var nb=1,ob=2;ea.prototype={set:function(a){return ha(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?ob:nb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&kb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===ob||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(hb|ib|jb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof U)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);c!==-1&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ga(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&fa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ha(da,{INPUT_START:Aa,INPUT_MOVE:Ba,INPUT_END:Ca,INPUT_CANCEL:Da,STATE_POSSIBLE:gb,STATE_BEGAN:hb,STATE_CHANGED:ib,STATE_ENDED:jb,STATE_RECOGNIZED:kb,STATE_CANCELLED:lb,STATE_FAILED:mb,DIRECTION_NONE:Ea,DIRECTION_LEFT:Fa,DIRECTION_RIGHT:Ga,DIRECTION_UP:Ha,DIRECTION_DOWN:Ia,DIRECTION_HORIZONTAL:Ja,DIRECTION_VERTICAL:Ka,DIRECTION_ALL:La,Manager:ea,Input:x,TouchAction:S,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:U,AttrRecognizer:Y,Tap:ca,Pan:Z,Swipe:ba,Pinch:$,Rotate:aa,Press:_,on:m,off:n,each:g,merge:pa,extend:oa,assign:ha,inherit:i,bindFn:j,prefixed:u});var pb="undefined"!=typeof a?a:"undefined"!=typeof self?self:{};pb.Hammer=da,"function"==typeof define&&define.amd?define(function(){return da}):"undefined"!=typeof module&&module.exports?module.exports=da:a[c]=da}(window,document,"Hammer"),function(){"use strict";function a(a,b,c,d,e){function f(b){b&&(m.content.height=$(q.content).height()),$(q.container).css("width",m.container.width).css("height",m.container.height),n.height=m.content.height-m.container.height,n.height<0&&(n.height=0),n.top>n.height&&(n.top=n.height);var c=e?0:30,d=e?0:60;return p.enabled?(m.scrollContainer.x=null==p.x?m.container.width:p.x,m.scrollContainer.y=null==p.y?c:p.y+c,m.scrollContainer.width=null==p.width?l.scrollContainerWidth:p.width,m.scrollContainer.height=null==p.height?m.container.height-d:p.height-d):(m.scrollContainer.x=m.container.width,m.scrollContainer.y=c,m.scrollContainer.width=l.scrollContainerWidth,m.scrollContainer.height=m.container.height-d),q.scrollbar.innerHTML=null!=p.barInnerHtml?p.barInnerHtml:"",q.scrollbase.innerHTML=null!=p.baseInnerHtml?p.baseInnerHtml:"",o.scrollDividContent=m.scrollContainer.height/m.container.height,m.scrollbar.height=k?m.scrollbar.height:m.container.height/m.content.height*m.scrollContainer.height,n.topForScroll=n.top*o.scrollDividContent,n.heightForScroll=m.scrollContainer.height-m.scrollbar.height,n.height<=0?$(q.scrollContainer).css("display","none"):$(q.scrollContainer).css("display","block"),o.mouseWheelInterval=500/n.height*.1,o.buttonProgress=.3*o.mouseWheelInterval,$(q.scrollContainer).css("left",m.scrollContainer.x).css("top",m.scrollContainer.y).css("width",m.scrollContainer.width).css("height",m.scrollContainer.height),$(q.scrollbase).css("height",m.scrollContainer.height),k||$(q.scrollbar).css("height",m.scrollbar.height),$(q.scrollbarContainer).css("height",m.scrollbar.height),$(a).css("width","auto").css("height","auto").css("overflow","visible"),i(),a}function g(){var b=0;if(d){var c=new Hammer(q.container);c.on("panstart",function(a){a.preventDefault(),b=0}),c.on("panmove",function(a){a.preventDefault();var c=a.deltaY-b;b=a.deltaY,h(n.tProgress-c/n.height)});var e=new Hammer(q.scrollbarContainer);e.on("panstart",function(a){a.preventDefault(),b=0}),e.on("panmove",function(a){a.preventDefault();var c=-(a.deltaY-b);b=a.deltaY,h(n.tProgress-c/n.heightForScroll)})}else j(q.container,function(a){h(n.tProgress-a/n.height)}),j(q.scrollbarContainer,function(a){h(n.tProgress+a/n.heightForScroll)});$(q.scrollbarContainer).bind("mouseover",function(a){$(q.scrollbar).toggleClass("hover",!0)}),$(q.scrollbarContainer).bind("mouseout",function(a){$(q.scrollbar).toggleClass("hover",!1)}),$(document).bind("mousewheel",function(b,c){if($.contains(document,a)){b.stopPropagation();var d=c<0?o.mouseWheelInterval:-o.mouseWheelInterval;h(n.tProgress+d)}})}function h(a){var b=!1;return a<=0&&(a=0,b=!0),a>=1&&(a=1,b=!0),o.smoothMoving?(n.tProgress=a,TweenLite.to(n,.4,{progress:a,onUpdate:i})):(n.tPprogress=n.progress=a,i()),b}function i(){n.top=n.height*n.progress,n.topForScroll=n.heightForScroll*n.tProgress,$(q.scrollbarContainer).css("top",n.topForScroll),$(q.content).css("top",-n.top)}function j(a,b){var c=!1,d=$(a);d.on("mousedown",function(a){function d(a){$(document).unbind("mouseup",d),$(document).unbind("mousemove",e)}function e(a){var c=a.clientY-f;f=a.clientY,b.call(null,c)}var f=a.clientY;c=!0,$(document).on("mouseup",d),$(document).on("mousemove",e)})}var k=!1;null==e&&(e=!0);var l={scrollContainerWidth:50},m={content:{x:0,y:0,width:0,height:0},container:{x:0,y:0,width:0,height:0},scrollContainer:{x:0,y:0,width:30,height:0},scrollbase:{x:0,y:0,width:0,height:0},scrollbar:{x:0,y:0,width:0,height:0}};null!=c&&(k=!0,m.scrollbar.height=c);var n={top:0,height:0,topForScroll:0,heightForScroll:0,progress:0,tProgress:0},o={scrollDividContent:1,mouseWheelInterval:.1,smoothMoving:!0,buttonInterval:30,buttonProgress:.02},p={enabled:!1,x:0,y:0,width:0,height:0,barInnerHtml:null,baseInnerHtml:null},q={content:null,container:null,scrollContainer:null,scrollbase:null,scrollbarContainer:null,scrollbar:null,btnUp:null,btnDown:null};return m.container.width=$(a).width(),m.container.height=$(a).height(),q.container=document.createElement("div"),q.container.className="ss_container",q.content=document.createElement("div"),q.content.className="ss_content",q.container.appendChild(q.content),q.content.innerHTML=a.innerHTML,a.innerHTML="",a.appendChild(q.container),null==b&&(b=$(q.content).height()),m.content.height=b,q.scrollContainer=document.createElement("div"),q.scrollContainer.className="ss_scroll_container",a.appendChild(q.scrollContainer),q.scrollbase=document.createElement("div"),q.scrollbase.className="ss_scrollbase",q.scrollContainer.appendChild(q.scrollbase),q.scrollbarContainer=document.createElement("div"),q.scrollbarContainer.className="ss_scrollbar_container",q.scrollContainer.appendChild(q.scrollbarContainer),q.scrollbar=document.createElement("div"),q.scrollbar.className="ss_scrollbar",q.scrollbarContainer.appendChild(q.scrollbar),e||(q.btnUp=document.createElement("div"),q.btnUp.className="ss_button_up",q.scrollContainer.appendChild(q.btnUp),q.btnDown=document.createElement("div"),q.btnDown.className="ss_button_down",q.scrollContainer.appendChild(q.btnDown)),a.containerSize=function(b,c){return null!=b&&(m.container.width=b),null!=c&&(m.container.height=c),a},a.contentHeight=function(b){return m.content.height=b,a},a.scrollbarInnerHtml=function(b){return p.barInnerHtml=b,a},a.scrollbaseInnerHtml=function(b){return p.baseInnerHtml=b,a},a.scrollbarHeight=function(b){return m.scrollbar.height=b,a},a.scrollBound=function(b,c,d,e){return p.enabled=!0,p.x=b,p.y=c,p.width=d,p.height=e,a},a.update=f,a.updateProgress=h,a.doms=q,g(),a}window.SimpleScroller=a}(),function(){"use strict";function a(a,b){function c(){var b="https://www.facebook.com/dialog/oauth?client_id="+Main.settings.fb_appid+"&scope="+Main.settings.fbPermissions.join(",")+"&state="+a+"&redirect_uri="+encodeURI(Utility.getPath());window.open(b,"_self")}function d(a){a&&(Main.settings.fbToken=a.accessToken,Main.settings.fbUid=a.userID),Loading.hide(),b&&b.apply()}a||(a="/Index"),Loading.progress("登入 Facebook 中...請稍候").show(),Main.settings.fbUid?d():Main.settings.isiOS?FB.getLoginStatus(function(a){"connected"===a.status?d(a.authResponse):c()}):FB.login(function(a){a.error?alert("登入 Facebook 失敗"):a.authResponse?d(a.authResponse):(alert("您必須登入 Facebook 才能參加本活動"),Loading.hide())},{scope:Main.settings.fbPermissions,return_scopes:!0,auth_type:"rerequest"})}function b(){var a,b=$(window).width(),d=($(window).height(),c.settings.viewport);for(a=0;a<d.ranges.length&&!(d.ranges[a]>=b);a++);d.index=a,d.width=b,d.height=d,SceneHandler.currentScene&&SceneHandler.currentScene.resize()}var c=window.Main={localSettings:{fb_appid:"153719541717801"},settings:{isLocal:!1,isMobile:!1,useFakeData:!1,fb_appid:"153715675051521",fbPermissions:[],fbToken:null,fbUid:null,isiOS:!1,viewport:{width:0,height:0,ranges:[640],index:0}},init:function(){if("local.savorks.com"!=window.location.host&&"socket.savorks.com"!=window.location.host||($.extend(c.settings,c.localSettings),Main.settings.isLocal=!0),(Main.settings.isLocal||"1"==Utility.urlParams.usefakedata)&&(Main.settings.useFakeData=!0),Utility.urlParams.state){var a=history.length;history.go(-a),window.location.replace(Utility.getPath()+"#"+Utility.urlParams.state)}c.settings.isiOS=Utility.isiOS();var d="1"==Utility.urlParams.nocache?(new Date).getTime():"0",e=["/Index","/Participate","/Entries","/Rule","/Reviewer","/Fill"],f=[];CommonForm.init(),EntryView.init(),Menu.init(),FBHelper.init(Main.settings.fb_appid,function(){function a(){SceneHandler.init(e,{blockHashs:f,listeningHashChange:!0,version:d,cbBeforeChange:function(){},cbContentChange:function(a){},hashChangeTester:function(a){if(("/Participate"==a||"/Entries"==a)&&!Main.settings.fbToken){console.log("no token");var b=a;a=null,SceneHandler.setHash(b)}return a}}),SceneHandler.toFirstHash()}FBHelper.checkLoginStatus(Main.settings.fbPermissions,function(b,c){null==b?(Main.settings.fbToken=c.accessToken,Main.settings.fbUid=c.userID,a()):a()})}),$(window).on("resize",b),b()},loginFB:a}}(),function(){function a(a,b,e){var f=c.buttons[b]=c.buttonContainer.find(".button:nth-child("+a+")");f.toggleClass("activated",!0).on("click",function(){d.hide(),e&&e.call()})}var b=!0,c={},d=window.Menu={init:function(){c.container=$("#menu"),c.cover=$("#menu-cover").on("click",function(){d.hide()}),c.trigger=c.container.find(".icon").on("click",function(){b?d.show():d.hide()}),c.buttonContainer=c.container.find(".button-container"),c.buttons={},a(1,"index",function(){SceneHandler.toHash("/Index")}),a(2,"reviewer",function(){SceneHandler.toHash("/Reviewer")}),a(3,"participate",function(){Main.loginFB("/Participate",function(){SceneHandler.toHash("/Participate")})}),a(4,"vote",function(){Main.loginFB("/Participate",function(){SceneHandler.toHash("/Entries")})}),a(5,"fill",function(){Main.loginFB("/Fill",function(){SceneHandler.toHash("/Fill")})}),a(6,"entries",function(){Main.loginFB("/Participate",function(){SceneHandler.toHash("/Entries")})}),a(7,"participate",function(){SceneHandler.toHash("/Rule")}),c.buttonContainer.css("visibility","visible").toggleClass("close-mode",!0)},show:function(){b&&(b=!1,c.cover.css("display","block"),c.buttonContainer.toggleClass("close-mode",!1))},hide:function(){b||(b=!0,c.cover.css("display","none"),c.buttonContainer.toggleClass("close-mode",!0))}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),d.container=$("#index"),d.btnToParticipate=d.container.find(".button-1").on("click",function(){Main.loginFB("/Participate",function(){SceneHandler.toHash("/Participate")})}),d.btnToParticipate=d.container.find(".button-2").on("click",function(){Main.loginFB("/Fill",function(){SceneHandler.toHash("/Fill")})}),d.btnToEntries=d.container.find(".button-3").on("click",function(){Main.loginFB("/Entries",function(){SceneHandler.toHash("/Entries")})}),d.container.detach()}function b(a){$("#scene-container").append(d.container);var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){var b=new TimelineMax;b.to(d.container,.4,{autoAlpha:0}),b.add(function(){d.container.detach(),a.apply()})}var d={},e=!1;window.Index={stageIn:function(c,d){function f(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_index.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),e=!0,b.apply(null,[!0])},0)}e?f():g(f)},stageOut:function(a,b){c(b)},resize:function(a,b,c){}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),d.container=$("#rule"),d.contentContainer=d.container.find(".content-container");var b=d.contentContainer.height(),c=new SimpleScroller(d.contentContainer[0],null,0,Modernizr.touchevents).update(!0),e=$(c.doms.container);c.containerSize(null,b).scrollBound(e.width()+10,3,0,b-44).update(!0),d.btnClose=d.container.find(".btn-close").on("click",function(){var a=SceneHandler.getLastHash();a?SceneHandler.toHash(a):SceneHandler.toHash("/Index")}),d.container.detach()}function b(a){$("#scene-container").append(d.container);var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){var b=new TimelineMax;b.to(d.container,.4,{autoAlpha:0}),b.add(function(){d.container.detach(),a.apply()})}var d={},e=!1;window.Rule={stageIn:function(c,d){function f(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_rule.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),e=!0,b.apply(null)},0)}e?f():g(f)},stageOut:function(a,b){c(b)},resize:function(a,b,c){}}}(),function(){function a(a){d={upload:h.UploadStep,form:CommonForm},$("#invisible-container").append(a[0].dom),e.container=$("#participate"),h.Title.init(e.container.find(".content-title")),h.UploadStep.init(e.container.find(".content-step-upload")),h.Success.init($("#participate-success")),e.container.detach()}function b(a){return Main.settings.fbToken?($("#scene-container").append(e.container),g="upload",h.Title.show(),void d[g].show(0,a)):void a.apply()}function c(a){d[g].hide(),h.Title.hide(0,function(){e.container.detach(),a.apply()})}var d,e={},f=!1,g="upload",h=window.Participate={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_participate.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),f=!0,b.apply(null)},0)}f?e():g(e)},stageOut:function(a,b){c(b)},toStep:function(a){a!=g&&(d[g].hide(),g=a,"form"==g&&CommonForm.setMode("participate"),d[g].show())},resize:function(a,b,c){}}}(),function(){var a={},b=!0;window.Participate.Title={init:function(b){a.container=b,a.parent=b.parent(),a.container.detach()},show:function(c,d){if(b){b=!1,a.parent.append(a.container),void 0===c&&(c=0);var e=new TimelineMax;e.set(a.container,{autoAlpha:0}),e.to(a.container,.4,{autoAlpha:1},c),e.add(function(){d&&d.apply()})}},hide:function(c,d){if(!b){b=!0;var e=new TimelineMax;e.to(a.container,.4,{autoAlpha:0},c),e.add(function(){a.container.detach(),d&&d.apply()})}}}}(),function(){var a={},b=!0,c=null,d=window.Participate.Success={init:function(b){a.container=b,a.parent=$("body"),a.btnClose=a.container.find(".btn-close").on("click",function(){d.hide(),SceneHandler.toHash("/Index")}),a.btnShare=a.container.find(".btn-share").on("click",function(){FB.ui({method:"share",display:"iframe",href:Utility.getPath()+"?serial="+c},function(a){a.error||a.error_code||(d.hide(),SceneHandler.toHash("/Index"))})}),a.container.detach()},show:function(c,d){if(b){b=!1,a.parent.append(a.container),void 0===c&&(c=0);var e=new TimelineMax;e.set(a.container,{autoAlpha:0}),e.to(a.container,.4,{autoAlpha:1},c),e.add(function(){d&&d.apply()})}},hide:function(c,d){if(!b){b=!0;var e=new TimelineMax;e.to(a.container,.4,{autoAlpha:0},c),e.add(function(){a.container.detach(),d&&d.apply()})}},setShareEntrySerial:function(a){c=a}}}(),function(){function a(){g=!!k.getImage(),h=k.getDescriptionInput().length>=20,i=d.ruleCheckbox[0].checked;var a=g&&h&&i;d.btnSend.toggleClass("disactivated",!a),d.btnPreview.toggleClass("disactivated",!g)}function b(b){b.defaultText=b.val(),b.on("focus",function(){b.val()==b.defaultText&&b.val("")}).on("blur",function(){""==b.val()&&b.val(b.defaultText)}).on("input propertychange",function(){a()})}function c(){function b(){g.value=null,g.click()}function c(a,b){if(a.files&&a.files[0]){var c=new FileReader;c.onload=function(a){e(a.target.result,b)},c.readAsDataURL(a.files[0])}}function e(a,b){f.image&&($(f.image).detach(),f.image=null),f.rawCanvas&&($(f.rawCanvas).detach(),f.rawCanvas=null),f.previewCanvas&&($(f.previewCanvas).detach(),f.previewCanvas=null),f.thumbCanvas&&($(f.thumbCanvas).detach(),f.thumbCanvas=null),f.image=document.createElement("img"),f.image.onload=function(){if(f.image.width!=j.raw.w||f.image.height!=j.raw.h){var a="您所上傳的圖片尺寸 ( "+f.image.width+" x "+f.image.height+" ) 和我們的作品規格 ( "+j.raw.w+" x "+j.raw.h+" ) 不同\n\n將自動裁切或縮放, 請預覽圖片確定內容是否正確.";alert(a)}b&&b.call()},f.image.src=a}var g=d.container.find(".image-input")[0];d.btnSelectImage=d.container.find(".btn-upload").on("click",b),$(g).on("change",function(){Loading.progress("empty").show(),c(g,function(){a(),Loading.hide()})})}var d={},e=!0,f={},g=!1,h=!1,i=!1,j={raw:{w:1200,h:900},preview:{w:474,h:356},thumb:{w:133,h:100}},k=window.Participate.UploadStep={init:function(e){d.container=e,d.parent=e.parent(),d.textArea=d.container.find(".description"),b(d.textArea),c(),d.btnRule=d.container.find(".btn-rule").on("click",function(){SceneHandler.toHash("/Rule")}),d.ruleCheckbox=d.container.find("#upload-checkbox").on("change",function(){a()}),d.btnSend=d.container.find(".btn-send").on("click",function(){g?h?i?Participate.toStep("form"):alert("您必須同意我們的活動辦法"):alert("請輸入 20 個字元以上的作品說明"):alert("請先選擇欲上傳的圖片")}),d.btnPreview=d.container.find(".btn-preview").on("click",function(){g?EntryView.showPreview(k.getPreviewCanvas(),k.getDescriptionInput()):alert("請先選擇欲上傳的圖片")}),d.container.detach()},show:function(b,c){if(e){e=!1,d.parent.append(d.container),a(),void 0===b&&(b=0);var f=new TimelineMax;f.set(d.container,{autoAlpha:0}),f.to(d.container,.4,{autoAlpha:1},b),f.add(function(){c&&c.apply()})}},hide:function(a,b){if(!e){e=!0;var c=new TimelineMax;c.to(d.container,.4,{autoAlpha:0},a),c.add(function(){d.container.detach(),b&&b.apply()})}},getDescriptionInput:function(){var a=d.textArea.val();return a==d.textArea.defaultText&&(a=""),a},getRawCanvas:function(){return k.getCanvas("raw")},getPreviewCanvas:function(){return k.getCanvas("preview")},getThumbCanvas:function(){return k.getCanvas("thumb")},getImage:function(){return f.image},getCanvas:function(a){var b=a+"Canvas";if(!f[b]){if(!f.image)return null;var c=j[a];f[b]=Helper.imageToCanvas(f.image,c.w,c.h)}return f[b]}}}(),function(){function a(){e.fields.name.val(""),e.fields.phone.val(""),e.fields.email.val(""),e.fields.ruleCheck[0].checked=!1}function b(){var a=c();if(a){var b,e;"participate"==g?(b=Participate.UploadStep.getRawCanvas(),b?(e=b.toDataURL("image/jpeg",.95).replace(/^data:image\/jpeg;base64,/,""),a.image_data=e,a.description=Participate.UploadStep.getDescriptionInput(),Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("participate",a,!0,function(a){a.error?alert(a.error):(Participate.Success.setShareEntrySerial(a.serial),Participate.Success.show()),Loading.hide()})):alert("lack image data")):"vote"==g?d?(a.serial=d,Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("entries_vote",a,!0,function(a){a.error?alert(a.error):(Entries.VoteSuccess.setShareEntrySerial(a.serial),Entries.VoteSuccess.setShareImageUrl(a.share_url),Entries.VoteSuccess.show()),Loading.hide()})):alert("lack voting serial"):"fill"==g?(b=Fill.getSendingCanvas(),b?(e=b.toDataURL("image/jpeg",.95).replace(/^data:image\/jpeg;base64,/,""),a.image_data=e,Loading.progress("資料傳輸中 ... 請稍候").show(),ApiProxy.callApi("filling_attending",a,!0,function(a){a.error?alert(a.error):(console.log("success"),console.log(a.share_url),Fill.Success.setShareImageUrl(a.share_url),Fill.Success.show()),Loading.hide()})):alert("lack image data")):alert("unsupported mode")}}function c(){var a,b={};return e.fields.ruleCheck.prop("checked")?(a=e.fields.name[0],PatternSamples.onlySpace.test(a.value)?(alert("請輸入您的名稱"),void a.focus()):(b.name=a.value,a=e.fields.phone[0],PatternSamples.phone.test(a.value)?(b.phone=a.value,a=e.fields.email[0],PatternSamples.email.test(a.value)?(b.email=a.value,b.fb_uid=Main.settings.fbUid,b.fb_token=Main.settings.fbToken,b):(alert("請輸入您的電子郵件信箱"),void a.focus())):(alert("請輸入正確的手機號碼"),void a.focus()))):void alert('您必須同意 "授權主辦單位使用本人個人資料" 才能參加活動')}var d,e={},f=!0,g=null,h=window.CommonForm={init:function(){e.parent=$("#scene-container"),e.container=$("#common-form"),e.eulaContentContainer=e.container.find(".content-container");var a=e.eulaContentContainer.height(),c=new SimpleScroller(e.eulaContentContainer[0],null,0,Modernizr.touchevents).update(!0),d=$(c.doms.container);c.containerSize(null,a).scrollBound(d.width()-21,0,0,a-38).update(!0),e.fields={name:e.container.find(".field-name"),phone:e.container.find(".field-phone"),email:e.container.find(".field-email"),ruleCheck:e.container.find("#eula-checkbox")},e.btnSend=e.container.find(".btn-send").on("click",function(){b()}),e.container.detach()},show:function(b,c){if(f){f=!1,e.parent.append(e.container),a(),void 0===b&&(b=0);var d=new TimelineMax;d.set(e.container,{autoAlpha:0}),d.to(e.container,.4,{autoAlpha:1},b),d.add(function(){c&&c.apply()})}},hide:function(a,b){if(!f){f=!0;var c=new TimelineMax;c.to(e.container,.4,{autoAlpha:0},a),c.add(function(){e.container.detach(),b&&b.apply()})}},setVotingSerial:function(a){d=a},setMode:function(a){return g=a,h}}}(),function(){var a={participate:{error:"",serial:"0001"},entries_vote:{error:""},entries_search:{error:"",data:[{serial:"0088",status:"approved",name:"John",num_votes:"31231",thumb_url:"http://xxxx.xx/thumbxxx.jpg",url:"http://xxxx.xx/imagexxx.jpg",description:"bablalalala"}],num_pages:13,page_index:3,page_size:10},"entries_search.serial":{error:"",data:[{serial:"0088",status:"approved",name:"John",num_votes:"31231",thumb_url:"./images/participate-upload-title-girl.png",url:"./images/participate-upload-title-girl.png",description:"bablalalala"}],num_pages:1,page_index:0,page_size:1},"entries_search.single":{error:"",data:[{serial:"7354",status:"approved",name:"John",num_votes:"6945",thumb_url:"./images/participate-upload-title-girl.png",url:"./images/participate-upload-title-girl.png",description:"bablalalala"}],num_pages:123,page_index:0,page_size:1},filling_attending:{error:"",share_url:"https://2016summer.tw/misc/fb-share.jpg"}},b="",c="/process/";window.ApiProxy={callApi:function(d,e,f,g){function h(a){g&&g.call(null,a)}if(Main.settings.useFakeData&&f){f===!0&&(f=d);var i=a[f];if("entries_search"==f){i.page_index=e.page_index,i.data=[];var j,k,l=e.page_index,m=l*e.page_size,n=123;for(k=0;k<e.page_size&&(j=m+k,i.data.push({serial:j,name:"name "+j,num_votes:parseInt(3e3*Math.random()),
description:"description "+j,thumb_url:"./images/participate-upload-title-girl.png",url:"./images/participate-upload-title-girl.png"}),!(j>=n-1));k++);}else"entries_search.single"==f&&(i.page_index=e.page_index,i.data[0].serial=i.page_index);h(i)}else{var o=c+d+b,p="POST";$.ajax({url:o,type:p,data:e,dataType:"json"}).done(h).fail(function(){h({error:"無法取得伺服器回應"})})}}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),e.container=$("#entries"),d={list:h.List,vote:CommonForm},h.Title.init(e.container.find(".content-title")),h.List.init(e.container.find(".content-list")),h.Reviewing.init($("#entries-reviewing")),h.Unapproved.init($("#entries-unapproved")),h.VoteSuccess.init($("#entries-vote-success")),e.container.detach()}function b(a){return Main.settings.fbToken?($("#scene-container").append(e.container),h.resize(),g="list",h.Title.show(),void h.List.show(0,a)):void a.apply()}function c(a){d[g].hide(),h.Title.hide(0,function(){e.container.detach(),a.apply()})}var d,e={},f=!1,g="upload",h=window.Entries={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_entries.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),f=!0,b.apply(null)},0)}f?e():g(e)},stageOut:function(a,b){c(b)},toStep:function(a){a!=g&&(d[g].hide(),g=a,"vote"==g&&CommonForm.setMode("vote"),d[g].show())},resize:function(){var a=Main.settings.viewport;h.List.resize(a)}}}(),function(){var a={},b=!0;window.Entries.Title={init:function(b){a.container=b,a.parent=b.parent(),a.container.detach()},show:function(c,d){if(b){b=!1,a.parent.append(a.container),void 0===c&&(c=0);var e=new TimelineMax;e.set(a.container,{autoAlpha:0}),e.to(a.container,.4,{autoAlpha:1},c),e.add(function(){d&&d.apply()})}},hide:function(c,d){if(!b){b=!0;var e=new TimelineMax;e.to(a.container,.4,{autoAlpha:0},c),e.add(function(){a.container.detach(),d&&d.apply()})}}}}(),function(){var a={},b=!0,c=window.Entries.Reviewing={init:function(b){a.container=b,a.parent=$("body"),a.btnClose=a.container.find(".btn-close").on("click",function(){c.hide()}),a.btnEntries=a.container.find(".btn-entries").on("click",function(){c.hide()}),a.container.detach()},show:function(c,d){if(b){b=!1,a.parent.append(a.container),void 0===c&&(c=0);var e=new TimelineMax;e.set(a.container,{autoAlpha:0}),e.to(a.container,.4,{autoAlpha:1},c),e.add(function(){d&&d.apply()})}},hide:function(c,d){if(!b){b=!0;var e=new TimelineMax;e.to(a.container,.4,{autoAlpha:0},c),e.add(function(){a.container.detach(),d&&d.apply()})}}}}(),function(){var a={},b=!0,c=window.Entries.Unapproved={init:function(b){a.container=b,a.parent=$("body"),a.btnClose=a.container.find(".btn-close").on("click",function(){c.hide()}),a.btnEntries=a.container.find(".btn-entries").on("click",function(){c.hide()}),a.container.detach()},show:function(c,d){if(b){b=!1,a.parent.append(a.container),void 0===c&&(c=0);var e=new TimelineMax;e.set(a.container,{autoAlpha:0}),e.to(a.container,.4,{autoAlpha:1},c),e.add(function(){d&&d.apply()})}},hide:function(c,d){if(!b){b=!0;var e=new TimelineMax;e.to(a.container,.4,{autoAlpha:0},c),e.add(function(){a.container.detach(),d&&d.apply()})}}}}(),function(){var a,b,c={},d=!0,e=window.Entries.VoteSuccess={init:function(d){c.container=d,c.parent=$("body"),c.btnClose=c.container.find(".btn-close").on("click",function(){e.hide(),Entries.toStep("list")}),c.btnShare=c.container.find(".btn-share").on("click",function(){FB.ui({method:"share",display:"iframe",href:Utility.getPath()+"?serial="+a,picture:b},function(a){a.error||a.error_code||(e.hide(),Entries.toStep("list"))})}),c.container.detach()},show:function(a,b){if(d){d=!1,c.parent.append(c.container),void 0===a&&(a=0);var e=new TimelineMax;e.set(c.container,{autoAlpha:0}),e.to(c.container,.4,{autoAlpha:1},a),e.add(function(){b&&b.apply()})}},hide:function(a,b){if(!d){d=!0;var e=new TimelineMax;e.to(c.container,.4,{autoAlpha:0},a),e.add(function(){c.container.detach(),b&&b.apply()})}},setShareEntrySerial:function(b){a=b},setShareImageUrl:function(a){b=a}}}(),function(){function a(){f.loadingHint.css("display","block"),f.pageIndexContainer.css("display","none"),f.arrowLeft.css("visibility","hidding"),f.arrowRight.css("visibility","hidding")}function b(){f.arrowLeft.css("visibility","visible"),f.arrowRight.css("visibility","visible");var a=[f.arrowLeft,f.arrowRight,f.pageIndexContainer],b=new TimelineMax;b.set(a,{opacity:0}),b.to(a,.4,{opacity:1}),f.loadingHint.css("display","none"),f.pageIndexContainer.css("display","block")}function c(a,b,c,d,f,g){var h=new o.Thumb(b,c,d,f,g);l.push(h),h.$dom.on("click",function(){var b=$.extend({},e),c=b.page_size*b.page_index+a;b.page_size=1,b.page_index=c,EntryView.showEntryAt(b)})}function d(a){var b,c;for(b=0;b<a.length;b++)c=a[b],c.destroy()}var e,f={},g=!0,h=!1,i="",j="date",k=10,l=[],m=[],n={0:{w:10,h:10},1:{w:36,h:13}},o=window.Entries.List={init:function(a){f.container=a,f.parent=a.parent(),f.arrowLeft=f.container.find(".arrow-left").on("click",function(){o.PageIndex.toPrevPage()}),f.arrowRight=f.container.find(".arrow-right").on("click",function(){o.PageIndex.toNextPage()}),o.updateArrows(!1,!1),f.outputMask=f.container.find(".output-mask"),f.outputA=f.container.find(".output-container:nth-child(1)"),f.outputB=f.container.find(".output-container:nth-child(2)").detach(),o.Thumb.$sample=f.container.find(".thumb-container").detach(),f.pageIndexContainer=f.container.find(".page-index-container"),o.PageIndex.init(f.pageIndexContainer),f.loadingHint=f.container.find(".loading-hint").css("display","none"),f.keywordInput=f.container.find(".field-keyword").on("keyup",function(a){13==a.keyCode&&f.btnSearchName.click()}),f.btnSearchName=f.container.find(".btn-name").on("click",function(){h||(i=f.keywordInput.val(),o.doSearch(0,!0))}),f.btnSearchSerial=f.container.find(".btn-serial").on("click",function(){h||(i=f.keywordInput.val(),f.keywordInput.val(""),o.doSearch(0,!0,null,!0))}),f.btnSortByDate=f.container.find(".tab-by-date").on("click",function(){h||o.changeSortType("date")}),f.btnSortByRank=f.container.find(".tab-by-rank").on("click",function(){h||o.changeSortType("votes")}),f.container.detach()},show:function(a,b){if(g){g=!1,f.parent.append(f.container),void 0===a&&(a=0);var c=new TimelineMax;c.set(f.container,{autoAlpha:0}),c.to(f.container,.4,{autoAlpha:1},a),c.add(function(){b&&b.apply(),f.keywordInput.val(""),i="",o.doSearch(0,!0)})}},hide:function(a,b){if(!g){g=!0;var c=new TimelineMax;c.to(f.container,.4,{autoAlpha:0},a),c.add(function(){f.container.detach(),b&&b.apply()})}},resize:function(a){},changeSortType:function(a){a!=j&&(h||(j=a,"date"==j?(f.btnSortByDate.toggleClass("activated",!0),f.btnSortByRank.toggleClass("activated",!1)):(f.btnSortByDate.toggleClass("activated",!1),f.btnSortByRank.toggleClass("activated",!0)),i=f.keywordInput.val(),o.doSearch(0,!0)))},updateArrows:function(a,b){f.arrowLeft.css("display",a?"block":"none"),f.arrowRight.css("display",b?"block":"none")},doSearch:function(c,d,f,g){if(!h){h=!0,a();var l="bottom",m=i;d||(c>f?l="right":c<f&&(l="left"));var n=e={keyword:i,search_type:g?"serial":"user_name",status:g?"":"approved",sort_type:j,page_index:c,page_size:k};g?ApiProxy.callApi("entries_search",n,"entries_search.serial",function(a){TweenMax.delayedCall(.5,function(){if(a.error)alert(a.error);else if(0==a.data.length)alert("很抱歉, 作品編號 ["+m+"] 並不存在");else{var c=a.data[0];"approved"==c.status?EntryView.showEntry(c):(c.status="reviewing")?Entries.Reviewing.show():(c.status="unapproved")&&Entries.Unapproved.show()}b(),h=!1})}):ApiProxy.callApi("entries_search",n,"entries_search",function(a){TweenMax.delayedCall(.5,function(){a.error?alert(a.error):(o.PageIndex.update(parseInt(a.num_pages),parseInt(a.page_index)+1),o.updateEntries(a.data,l)),b()})})}},updateEntries:function(a,b){m=l,l=[];var d,e;for(d=0;d<a.length;d++)e=a[d],c(d,f.outputB,e.num_votes,e.name,e.serial,e.thumb_url);o.animeEntries(b)},animeEntries:function(a){var b=n[Main.settings.viewport.index];f.outputMask.append(f.outputB);var c=f.outputMask.height()+b.h,e=f.outputMask.width()+b.w,g=new TimelineMax,i=.5,j=Power3.easeInOut;"bottom"==a?(j=Power2.easeInOut,g.set(f.outputB,{left:0,top:c}),g.to(f.outputA,i,{top:-c,ease:j},0),g.to(f.outputB,i,{top:0,ease:j},0)):"right"==a?(i*=e/c,g.set(f.outputB,{left:e,top:0}),g.to(f.outputA,i,{left:-e,ease:j},0),g.to(f.outputB,i,{left:0,ease:j},0)):"left"==a&&(i*=e/c,g.set(f.outputB,{left:-e,top:0}),g.to(f.outputA,i,{left:e,ease:j},0),g.to(f.outputB,i,{left:0,ease:j},0)),g.add(function(){var a=f.outputA;f.outputA=f.outputB,f.outputB=a,f.outputB.detach(),d(m),m=[],h=!1})}}}(),function(){function a(a,b,c){var e=document.createElement("div");e.className="word",e.innerHTML=a;var f=$(e);return f.toggleClass("activated",c),b?d.container.prepend(f):d.container.append(f),c||f.on("click",function(){g.toPage(a)}),f}var b,c,d={},e=9,f=4,g=window.Entries.List.PageIndex={init:function(a){d.container=a,d.btnPrevPage=d.container.find(".word-prev-page").on("click",function(){g.toPrevPage()}).detach(),d.btnNextPage=d.container.find(".word-next-page").on("click",function(){g.toNextPage()}).detach(),d.btnPrevBlock=d.container.find(".word-prev-block").on("click",function(){g.toPrevBlock()}).detach(),d.btnNextBlock=d.container.find(".word-next-block").on("click",function(){g.toNextBlock()}).detach(),g.clear()},toPrevPage:function(){g.toPage(c-1)},toNextPage:function(){g.toPage(c+1)},toPrevBlock:function(){g.toPage(c-e)},toNextBlock:function(){g.toPage(c+e)},toPage:function(a){var d=c;a<1&&(a=1),a>b&&(a=b),Entries.List.doSearch(a-1,!1,d-1)},update:function(h,i){if(i<1||i>h)return console.log("illegal params, numPages: "+h+", pageIndex: "+i),void g.clear();g.clear(),b=h,c=i;var j,k,l=0,m=0;for(a(i,!1,!0),i++,l++;m<f&&i<=b;)a(i,!1,!1),i++,l++,m++;for(k=i-1,m=0,i=c-1;m<f&&i>=1;)a(i,!0,!1),i--,l++,m++;if(j=i+1,k<=b){for(i=k+1;l<e&&i<=b;)a(i,!1,!1),i++,l++;k=i-1}if(j>=1){for(i=j-1;l<e&&i>=1;)a(i,!0,!1),i--,l++;j=i+1}var n=!1,o=!1;1!==j&&d.container.prepend(d.btnPrevBlock),1!==c&&(d.container.prepend(d.btnPrevPage),n=!0),k!==b&&d.container.append(d.btnNextBlock),c!==b&&(d.container.append(d.btnNextPage),o=!0),Entries.List.updateArrows(n,o)},clear:function(){d.btnPrevPage.detach(),d.btnNextPage.detach(),d.btnPrevBlock.detach(),d.btnNextBlock.detach(),d.container.empty()}}}(),function(){function a(b,c,d,e,f){var g=this.$dom=a.$sample.clone();if(g.find(".text-num-votes").text("累積票數："+c),g.find(".text-author").text("作者："+d),g.find(".text-serial").text(e),f){var h=document.createElement("img");h.onload=function(){g.find(".thumb").append(h),TweenMax.from(h,.5,{opacity:0})},h.src=f}b.append(g)}window.Entries.List.Thumb=a,a.$sample=null,a.prototype={$dom:null,destroy:function(){this.$dom.detach()}}}(),function(){function a(){f.optionalFields.toggleClass("hidding",!0),f.arrowLeft.css("display","none"),f.arrowRight.css("display","none"),c(!1)}function b(a){f.optionalFields.toggleClass("hidding",!1),a?(f.arrowLeft.css("display","block"),f.arrowRight.css("display","block"),e&&(f.arrowLeft.css("visibility","visible"),f.arrowRight.css("visibility","visible"),e.page_index<=0&&f.arrowLeft.css("visibility","hidden"),e.page_index>=e.num_pages-1&&f.arrowRight.css("visibility","hidden"))):(f.arrowLeft.css("display","none"),f.arrowRight.css("display","none")),c(!0)}function c(a){a?(f.btnToList.toggleClass("hidding",!1),f.btnVote.toggleClass("hidding",!1)):(f.btnToList.toggleClass("hidding",!0),f.btnVote.toggleClass("hidding",!0))}var d,e,f={},g=!0,h=!1,i=window.EntryView={init:function(){f.parent=$("#scene-container"),f.container=$("#entry-view"),f.imagePreview=f.container.find(".image-preview"),f.optionalFields=f.container.find(".optional-fields"),f.arrowLeft=f.container.find(".arrow-left").on("click",function(){h||e&&(e.page_index--,e.page_index<0&&(e.page_index=0),i.showEntryAt(e))}),f.arrowRight=f.container.find(".arrow-right").on("click",function(){h||e&&(e.page_index++,e.page_index>=e.num_pages&&(e.page_index=e.num_pages-1),i.showEntryAt(e))}),f.fields={numVotes:f.container.find(".field-num-votes"),serial:f.container.find(".field-serial"),author:f.container.find(".field-author"),description:f.container.find(".field-description")},f.btnClose=f.container.find(".btn-close").on("click",function(){i.hide()}),f.btnToList=f.container.find(".btn-to-list").on("click",function(){i.hide()}),f.btnVote=f.container.find(".btn-vote").on("click",function(){i.hide(),CommonForm.setVotingSerial(d.serial),Entries.toStep("vote")}),f.container.detach()},showPreview:function(b,c){f.imagePreview.empty(),f.imagePreview.append(b),f.fields.description.text(c),a(),i.show()},showEntry:function(a,c){d=a;var e=document.createElement("img");e.src=a.url,f.imagePreview.empty(),f.imagePreview.append(e),f.fields.description.text(a.description),f.fields.numVotes.text(a.num_votes),f.fields.author.text(a.name),f.fields.serial.text(a.serial),b(c),i.show()},showEntryAt:function(a){e=a,h=!0,Loading.progress("資料讀取中...").show(),ApiProxy.callApi("entries_search",a,"entries_search.single",function(a){TweenMax.delayedCall(.5,function(){a.error?alert(a.error):(e.num_pages=parseInt(a.num_pages),i.showEntry(a.data[0],!0),h=!1,Loading.hide())})})},show:function(a,b){if(g){g=!1,f.parent.append(f.container),void 0===a&&(a=0);var c=new TimelineMax;c.set(f.container,{autoAlpha:0}),c.to(f.container,.4,{autoAlpha:1},a),c.add(function(){b&&b.apply()})}},hide:function(a,b){if(!g){g=!0;var c=new TimelineMax;c.to(f.container,.4,{autoAlpha:0},a),c.add(function(){f.container.detach(),b&&b.apply()})}}}}(),function(){function a(a){$("#invisible-container").append(a[0].dom),d.container=$("#reviewer"),d.container.detach()}function b(a){$("#scene-container").append(d.container);var b=new TimelineMax;b.set(d.container,{autoAlpha:0}),b.to(d.container,.4,{autoAlpha:1}),b.add(function(){a.apply()})}function c(a){var b=new TimelineMax;b.to(d.container,.4,{autoAlpha:0}),b.add(function(){d.container.detach(),a.apply()})}var d={},e=!1;window.Reviewer={stageIn:function(c,d){function f(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_reviewer.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){a(c),e=!0,b.apply(null)},0)}e?f():g(f)},stageOut:function(a,b){c(b)},resize:function(a,b,c){}}}(),function(){function a(a){d={"illustrator-list":j.IllustratorList,"illust-list":j.IllustList,form:CommonForm},$("#invisible-container").append(a[0].dom),e.container=$("#fill"),j.Title.init(e.container.find(".content-title")),j.IllustratorList.init(e.container.find(".illustrator-list")),j.IllustList.init(e.container.find(".illust-list")),j.Success.init($("#fill-success")),e.container.detach()}function b(a){return Main.settings.fbToken?($("#scene-container").append(e.container),g="illustrator-list",j.Title.toggleFormMode(!1).show(),void d[g].show(0,a)):void a.apply()}function c(a){d[g].hide(),j.Title.hide(0,function(){e.container.detach(),a.apply()})}var d,e={},f=!1,g="upload",h=null,i=null,j=window.Fill={stageIn:function(c,d){function e(a){a&&c.cbContentLoaded&&c.cbContentLoaded.call(),b(d)}function g(b){var c=[{url:"_fill.html",startWeight:0,weight:100,dom:null}];SceneHandler.loadTemplate(null,c,function(){i=document.createElement("img"),i.onload=function(){a(c),f=!0,b.apply(null)},i.src="./misc/share.4.0.raw.jpg"},0)}f?e():g(e)},stageOut:function(a,b){c(b)},toStep:function(a,b){if(a!=g){var c=g;g=a,d[c].hide(0,function(){"form"==g?(CommonForm.setMode("fill"),j.Title.toggleFormMode(!0)):(j.Title.toggleFormMode(!1),"illust-list"==g&&j.IllustList.toIllust(3*(b.illustratorIndex-1),0)),d[g].show()})}},setSendingIllust:function(a){h=a},getSendingCanvas:function(){if(h){var a={x:161,y:106,width:272,height:207},b=h.getOutputCanvas(),c=a.width/b.width,d=Helper.downScaleCanvas(b,c),e=Helper.imageToCanvas(i,i.width,i.height),f=e.getContext("2d");return f.drawImage(d,a.x,a.y),e}return null},resize:function(a,b,c){}}}(),function(){var a={},b=!0;window.Fill.Title={init:function(b){a.container=b,a.parent=b.parent(),a.container.detach()},show:function(c,d){if(b){b=!1,a.parent.append(a.container),void 0===c&&(c=0);var e=new TimelineMax;e.set(a.container,{autoAlpha:0}),e.to(a.container,.4,{autoAlpha:1},c),e.add(function(){d&&d.apply()})}},hide:function(c,d){if(!b){b=!0;var e=new TimelineMax;e.to(a.container,.4,{autoAlpha:0},c),e.add(function(){a.container.detach(),d&&d.apply()})}},toggleFormMode:function(b){return a.container.toggleClass("form-mode",b),this}}}(),function(){function a(a){var c=b["illustrator"+a]=b.container.find(".illustrator:nth-child("+a+")");c.on("click",function(){Fill.toStep("illust-list",{illustratorIndex:a})})}var b={},c=!0;window.Fill.IllustratorList={init:function(c){b.container=c,b.parent=c.parent(),a(1),a(2),a(3),b.container.detach()},show:function(a,d){if(c){c=!1,b.parent.append(b.container),void 0===a&&(a=0);var e=new TimelineMax;e.set(b.container,{autoAlpha:0}),e.to(b.container,.4,{autoAlpha:1},a),e.add(function(){d&&d.apply()})}},hide:function(a,d){if(!c){c=!0;var e=new TimelineMax;e.to(b.container,.4,{autoAlpha:0},a),e.add(function(){b.container.detach(),d&&d.apply()})}}}}(),function(){var a,b={},c=!0,d=window.Fill.Success={init:function(c){b.container=c,b.parent=$("body"),b.btnClose=b.container.find(".btn-close").on("click",function(){d.hide(),Fill.toStep("illustrator-list")}),b.btnShare=b.container.find(".btn-share").on("click",function(){FB.ui({method:"share",display:"iframe",href:Utility.getPath(),picture:a},function(a){a.error||a.error_code||(d.hide(),Fill.toStep("illustrator-list"))})}),b.container.detach()},show:function(a,d){if(c){c=!1,b.parent.append(b.container),void 0===a&&(a=0);var e=new TimelineMax;e.set(b.container,{autoAlpha:0}),e.to(b.container,.4,{autoAlpha:1},a),e.add(function(){d&&d.apply()})}},hide:function(a,d){if(!c){c=!0;var e=new TimelineMax;e.to(b.container,.4,{autoAlpha:0},a),e.add(function(){b.container.detach(),d&&d.apply()})}},setShareImageUrl:function(b){a=b}}}(),function(){function a(){var a=j[Main.settings.viewport.index].wrapSize;d.arrowLeft.toggleClass("hidding",c<=0),d.arrowRight.toggleClass("hidding",c>=g-a)}function b(a){i==a&&(a=null),i&&i.close(),i=a,i&&i.open()}var c,d={},e=!0,f=!1,g=9,h=[],i=null,j={0:{wGap:100,wrapSize:1,duration:.4},1:{wGap:366,wrapSize:3,duration:.8}},k=window.Fill.IllustList={init:function(a){d.container=a,d.parent=a.parent(),d.listContainer=d.container.find(".list-container"),d.arrowLeft=d.container.find(".arrow-left").on("click",function(){var a=j[Main.settings.viewport.index].wrapSize;k.toIllust(c-a)}),d.arrowRight=d.container.find(".arrow-right").on("click",function(){var a=j[Main.settings.viewport.index].wrapSize;k.toIllust(c+a)});for(var e=0;e<g;e++)h[e]=new k.Illust(e,parseInt(e/3)+1,d.container.find(".illust:nth-child("+(e+1)+")"),b);d.container.detach()},show:function(a,b){if(e){e=!1,d.parent.append(d.container);for(var c=0;c<h.length;c++)h[c].textToCanvas();void 0===a&&(a=0);var f=new TimelineMax;f.set(d.container,{autoAlpha:0}),f.to(d.container,.4,{autoAlpha:1},a),f.add(function(){b&&b.apply()})}},hide:function(a,b){if(!e){e=!0;var c=new TimelineMax;c.to(d.container,.4,{autoAlpha:0},a),c.add(function(){d.container.detach(),b&&b.apply()})}},toIllust:function(b,e){if(!f&&c!==b&&!(b<0||b>=g)){f=!0,c=b,a(),void 0===e&&(e=j[Main.settings.viewport.index].duration);var h=Main.settings.viewport.index,i=j[h].wGap,k=-i*c,l=new TimelineMax;l.to(d.listContainer,e,{left:k,ease:Power1.easeInOut}),l.add(function(){f=!1})}}}}(),function(){function a(a,b,c,d){function e(){d&&d.call(null,f)}var f=this;this._onTrigger=d,this.index=a,this.illustratorIndex=b,this.$container=c,this.$input=c.find(".field-input").on("input",function(){var a=f.$input.val();f.$btnSend.toggleClass("disactivated",0==a.length),f.textToCanvas()}),this.$inputBound=c.find(".fill-bound").val("請輸入十個以內的文字"),this.$btnSend=c.find(".btn-send").toggleClass("disactivated",!0).on("click",function(){var a=f.$input.val();""==a?alert("請先輸入對話文字"):(Fill.setSendingIllust(f),Fill.toStep("form"))});var g=c.css("background-image").replace('url("',"").replace('")',"");this.image=document.createElement("img");var h=$(this.image).css("cursor","pointer");this.image.onload=function(){h.on("click",e)},this.image.src=g,c.css("background-image","none"),this.$container.append(this.image)}window.Fill.IllustList.Illust=a,a.prototype={index:null,illustratorIndex:null,image:null,$container:null,$input:null,$inputBound:null,$btnSend:null,textCanvas:null,textCtx:null,_isOpen:!1,_oldText:null,_onTrigger:null,open:function(){this._isOpen||(this._isOpen=!0,this.$container.toggleClass("open-mode",!0),this.$inputBound.toggleClass("open-mode",!0),this.$input.focus(),this.textToCanvas())},close:function(){this._isOpen&&(this._isOpen=!1,this.$container.toggleClass("open-mode",!1),this.$inputBound.toggleClass("open-mode",this.$input.val().length>0))},textToCanvas:function(){var a={3:!0,8:!0},b=this,c=this.$inputBound;if(!this.textCtx){var d=this.textCanvas=document.createElement("canvas"),e=parseInt(c.css("left")),f=parseInt(c.css("top"));this.textCanvas.startLeft=this.textCanvas.finalLeft=e,this.textCanvas.startTop=this.textCanvas.finalTop=f,d.width=parseInt(c.css("width")),d.height=parseInt(c.css("height")),$(d).css("position","absolute").css("left",e).css("top",f).css("z-index",19).css("cursor","pointer").on("click",function(){b._onTrigger.call(null,b)}),this.textCtx=d.getContext("2d"),this.$container.append(this.textCanvas)}var g=this.$input.val(),h=this.textCanvas.width,i=this.textCanvas.height,j=parseInt(c.css("font-size")),k=parseInt(c.css("line-height")),l=c.css("font-family"),m=a[this.index];if(0==g.length?(this.textCtx.fillStyle="rgba(0,0,0,.3)",g="請輸入十個以內的文字"):this.textCtx.fillStyle="#000000",this._oldText!==g){this._oldText=g,this.textCtx.clearRect(0,0,this.textCanvas.width,this.textCanvas.height);var n,o,p,q,r=this.textCtx;for(r.font=j+"px "+l,m?(o=0,p=j-3):(o=h-j-2,p=j-3),n=0;n<g.length;n++)q=g[n],r.fillText(q,o,p),m?(o+=j,o>h-j&&(o=0,p+=k)):(p+=j,p>i&&(p=j-3,o-=k));var s=Helper.getContextBoundingBox(r);s&&(this.textCanvas.finalLeft=this.textCanvas.startLeft-s.x+.5*(h-s.w),this.textCanvas.finalTop=this.textCanvas.startTop-s.y+.5*(i-s.h),$(this.textCanvas).css("left",this.textCanvas.finalLeft).css("top",this.textCanvas.finalTop))}},getOutputCanvas:function(){var a=Helper.imageToCanvas(this.image,this.image.width,this.image.height);$(a).css("z-index",6e3).css("position","absolute");var b=a.getContext("2d");return b.drawImage(this.textCanvas,this.textCanvas.finalLeft,this.textCanvas.finalTop),a}}}();